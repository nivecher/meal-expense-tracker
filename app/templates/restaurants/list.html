{% extends "base.html" %}
    {% from 'macros/badge_helpers.html' import cuisine_badge %}

{% block title %}Restaurants - Meal Expense Tracker{% endblock %}

{% block styles %}
    <link href="{{ url_for('static', filename='css/components/navbar.css') }}" rel="stylesheet" />
    <link href="{{ url_for('static', filename='css/components/unified-table.css') }}" rel="stylesheet" />
    <link href="{{ url_for('static', filename='css/components/category-badges.css') }}" rel="stylesheet" />
    <link href="{{ url_for('static', filename='css/pages/restaurant-list.css') }}" rel="stylesheet" />
{% endblock styles %}

{% block content %}

<!-- Breadcrumb Navigation -->
{% set breadcrumb_items = [ {'url': url_for('main.index'), 'title': 'Dashboard'}, {'title': 'Restaurants'} ] %} {%
include 'includes/breadcrumb.html' %}

<!-- Header Section -->
<div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
    <h1 class="h3 mb-0"> <i class="fas fa-utensils text-primary me-2"></i>My Restaurants </h1>
    <div class="d-flex gap-2 flex-wrap">
        <!-- Primary Actions -->
        <a href="{{ url_for('restaurants.add_restaurant') }}" class="btn btn-primary" data-bs-toggle="tooltip" title="Add a new restaurant">
            <i class="fas fa-plus me-2"></i>Add Restaurant
        </a>
        <a href="{{ url_for('restaurants.find_places') }}" class="btn btn-outline-primary d-none d-md-inline-flex" data-bs-toggle="tooltip" title="Search for restaurants using Google Places">
            <i class="fas fa-search-location me-2"></i> Find Places
        </a>
        <!-- Mobile find button -->
        <a href="{{ url_for('restaurants.find_places') }}" class="btn btn-outline-primary d-md-none" data-bs-toggle="tooltip" title="Find places">
            <i class="fas fa-search-location me-1"></i>Find
        </a>
        <!-- Data Management Dropdown -->
        <div class="dropdown">
            <button
                class="btn btn-outline-secondary dropdown-toggle"
                type="button"
                id="dataManagementDropdown"
                data-bs-toggle="dropdown"
                aria-expanded="false">
                <i class="fas fa-database me-2"></i>Data Management
            </button>
            <ul class="dropdown-menu" aria-labelledby="dataManagementDropdown">
                <li>
                    <a class="dropdown-item" href="{{ url_for('restaurants.export_restaurants', format='csv') }}">
                        <i class="fas fa-file-csv me-2"></i> Export as CSV
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="{{ url_for('restaurants.export_restaurants', format='json') }}">
                        <i class="fas fa-file-code me-2"></i> Export as JSON
                    </a>
                </li>
                <li>
                    <hr class="dropdown-divider" />
                </li>
                <li>
                    <a class="dropdown-item" href="{{ url_for('restaurants.import_restaurants') }}">
                        <i class="fas fa-file-import me-2"></i> Import Restaurants
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>

<!-- Search & Filter + View Toggle Row -->
<div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
    <!-- Search & Filter Collapsible Button -->
    <div class="d-flex align-items-center">
        <button
            class="btn btn-outline-primary d-flex align-items-center"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#filterCollapse"
            aria-expanded="false"
            aria-controls="filterCollapse"
            data-tooltip="true"
            title="Show search and filter options">
            <i class="fas fa-filter me-2"></i>Search & Filter

            <i class="fas fa-chevron-down ms-2"></i>
        </button>

    </div>

    <!-- View Toggle -->
    <div class="btn-group" role="group" aria-label="View Toggle">
        <input type="radio" class="btn-check" name="view-type" id="card-view" autocomplete="off" checked />
        <label class="btn btn-outline-primary" for="card-view" id="card-view-label" data-bs-toggle="tooltip" title="Card view - shows restaurants in card format">
            <i class="fas fa-th-large me-2"></i>Cards
        </label>
        <input type="radio" class="btn-check" name="view-type" id="table-view" autocomplete="off" />
        <label class="btn btn-outline-primary" for="table-view" id="table-view-label" data-bs-toggle="tooltip" title="Table view - shows restaurants in table format">
            <i class="fas fa-table me-2"></i>Table
        </label>
    </div>
</div>

<!-- Collapsible Filter Form -->
<div class="collapse  mb-4" id="filterCollapse">
    <div class="card">
        <div class="card-body">
            <form method="get" class="row g-3" novalidate>
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                <!-- First Row -->
                <div class="col-md-6">
                    <label for="search" class="form-label">Search</label>
                    <input
                        type="text"
                        class="form-control"
                        id="search"
                        name="q"
                        value="{{ request.args.get('q', '') }}"
                        placeholder="Search restaurants, cuisines, cities, or notes" />
                </div>
                <div class="col-md-3">
                    <label for="cuisine" class="form-label">Cuisine</label>
                    <select class="form-control" id="cuisine" name="cuisine">
                        <option value="">All Cuisines</option>
                        {% for cuisine in cuisines %}
                        <option value="{{ cuisine }}" {% if request.args.get('cuisine') == cuisine %}selected{% endif %}>{{ cuisine }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="service_level" class="form-label">Service Level</label>
                    <select class="form-control" id="service_level" name="service_level">
                        <option value="">All Service Levels</option>
                        {% for level in service_levels %}
                        <option value="{{ level }}" {% if request.args.get('service_level') == level %}selected{% endif %}>{{ level.replace('_', ' ').title() }}</option>
                        {% endfor %}
                    </select>
                </div>
                <!-- Second Row -->
                <div class="col-md-4">
                    <label for="city" class="form-label">City</label>
                    <select class="form-control" id="city" name="city">
                        <option value="">All Cities</option>
                        {% for city in cities %}
                        <option value="{{ city }}" {% if request.args.get('city') == city %}selected{% endif %}>{{ city }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-2">
                    <label for="is_chain" class="form-label">Chain</label>
                    <select class="form-control" id="is_chain" name="is_chain">
                        <option value="">All</option>
                        <option value="true" {% if request.args.get('is_chain') == 'true' %}selected{% endif %}>Chain</option>
                        <option value="false" {% if request.args.get('is_chain') == 'false' %}selected{% endif %}>Independent</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label for="rating_min" class="form-label">Min Rating</label>
                    <input
                        type="number"
                        class="form-control"
                        id="rating_min"
                        name="rating_min"
                        min="1"
                        max="5"
                        step="0.1"
                        value="{{ request.args.get('rating_min', '') }}"
                        placeholder="1.0" />
                </div>
                <div class="col-md-2">
                    <label for="rating_max" class="form-label">Max Rating</label>
                    <input
                        type="number"
                        class="form-control"
                        id="rating_max"
                        name="rating_max"
                        min="1"
                        max="5"
                        step="0.1"
                        value="{{ request.args.get('rating_max', '') }}"
                        placeholder="5.0" />
                </div>
                <div class="col-md-2 d-flex align-items-end gap-2">
                    <button type="submit" class="btn btn-primary flex-fill" aria-label="Apply filters">
                        <i class="fas fa-search me-2" aria-hidden="true"></i> Filter
                    </button>
                    <a href="{{ url_for('restaurants.list_restaurants') }}" class="btn btn-outline-secondary" aria-label="Clear all filters">
                        <i class="fas fa-times me-2" aria-hidden="true"></i> Clear
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Pagination Controls -->
<div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
    <!-- Results Summary -->
    <div class="d-flex align-items-center">
        <span class="text-muted">
            {% if per_page == -1 %}
                Showing all {{ total_restaurants }} restaurant{{ 's' if total_restaurants != 1 else '' }}
            {% else %}
                Showing {{ page * per_page - per_page + 1 }}-{{ (page * per_page if page * per_page <= total_restaurants else total_restaurants) }} of {{ total_restaurants }} restaurants
                (Page {{ page }} of {{ total_pages }})
            {% endif %}
            {% if total_spent %}
                (Total Spent: ${{ "%.2f"|format(total_spent) }})
            {% endif %}
        </span>
    </div>

    <!-- Pagination Controls -->
    <div class="d-flex align-items-center gap-3">
        <!-- Items per page selector -->
        <div class="d-flex align-items-center">
            <label for="per_page" class="form-label mb-0 me-2 small text-muted">Show:</label>
            <select id="per_page" name="per_page" class="form-select form-select-sm border-0 bg-light per-page-select">
                <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
                <option value="25" {% if per_page == 25 %}selected{% endif %}>25</option>
                <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
                <option value="100" {% if per_page == 100 %}selected{% endif %}>100</option>
                <option value="-1" {% if per_page == -1 %}selected{% endif %}>All</option>
            </select>
        </div>

        <!-- Page navigation (only show if paginated) -->
        {% if total_pages > 1 %}
        <div class="btn-group" role="group" aria-label="Page navigation">
            <!-- Previous page -->
            {% if page > 1 %}
                <a class="btn btn-outline-primary btn-sm" href="{{ url_for('restaurants.list_restaurants', page=page-1, per_page=per_page, q=search, meal_type=meal_type, category=category, start_date=start_date, end_date=end_date) }}" aria-label="Previous">
                <i class="fas fa-chevron-left me-1"></i><span class="d-none d-sm-inline">Previous</span>
            </a>
            {% else %}
                <span class="btn btn-outline-secondary btn-sm" aria-label="Previous page not available" role="button" tabindex="-1">
                <i class="fas fa-chevron-left me-1"></i><span class="d-none d-sm-inline">Previous</span>
                </span>
            {% endif %}

            <!-- Page numbers -->
            {% for page_num in range(1, total_pages + 1) %}
                {% if page_num %}
                    {% if page_num != page %}
                        <a class="btn btn-outline-primary btn-sm" href="{{ url_for('restaurants.list_restaurants', page=page_num, per_page=per_page, q=search, meal_type=meal_type, category=category, start_date=start_date, end_date=end_date) }}" aria-label="Go to page {{ page_num }}">{{ page_num }}</a>
                    {% else %}
                        <span class="btn btn-primary btn-sm" aria-label="Current page {{ page_num }}" role="button" tabindex="-1">{{ page_num }}</span>
                    {% endif %}
                {% else %}
                    <span class="btn btn-outline-secondary btn-sm" aria-label="More pages available" role="button" tabindex="-1">...</span>
                {% endif %}
            {% endfor %}

            <!-- Next page -->
            {% if page < total_pages %}
                <a class="btn btn-outline-primary btn-sm" href="{{ url_for('restaurants.list_restaurants', page=page+1, per_page=per_page, q=search, meal_type=meal_type, category=category, start_date=start_date, end_date=end_date) }}" aria-label="Next">
                <span class="d-none d-sm-inline">Next</span><i class="fas fa-chevron-right ms-1"></i>
            </a>
            {% else %}
                <span class="btn btn-outline-secondary btn-sm" aria-label="Next page not available" role="button" tabindex="-1">
                <span class="d-none d-sm-inline">Next</span><i class="fas fa-chevron-right ms-1"></i>
                </span>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>

<!-- Restaurant List -->

    <!-- Card View (responsive grid) -->
    <div id="card-view-container" class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-3 mb-4">
        {% for restaurant in restaurants %}
        <div class="col">
            <div class="card h-100 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <!-- Left side: Icon and Title -->
                        <div class="d-flex align-items-start">
                            <!-- Restaurant Icon -->
                            <div class="restaurant-icon me-2 flex-shrink-0">
                                {% if restaurant.website %}
                                    <img
                                        src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"
                                        data-website="{{ restaurant.website }}"
                                        data-size="32"
                                        alt="{{ restaurant.name }} icon"
                                        class="restaurant-favicon"
                                        width="32"
                                        height="32"
                                        style="opacity: 0; transition: opacity 0.2s ease-in-out;"
                                    />
                                {% endif %}
                                <i class="fas fa-utensils text-primary restaurant-fallback-icon{% if restaurant.website %} d-none{% endif %}" style="font-size: 20px;"></i>
                            </div>

                            <!-- Title and Cuisine -->
                            <div>
                                <h5 class="card-title mb-1">
                                    <a
                                        href="{{ url_for('restaurants.restaurant_details', restaurant_id=restaurant.id) }}"
                                        class="text-decoration-none text-dark restaurant-name-link"
                                        data-bs-toggle="tooltip"
                                        title="View Restaurant details"
                                        >{{ restaurant.name }}</a
                                    >
                                </h5>

                                <div class="mt-1">
                                    {% from 'macros/badge_helpers.html' import cuisine_badge %}
                                    {{ cuisine_badge(restaurant.cuisine, size='sm') }}
                                </div>

                            </div>
                        </div>

                        <!-- Right side: Rating and Service Level -->
                        <div class="d-flex flex-column align-items-end">
                            {% if restaurant.rating %}
                            <span class="badge bg-warning text-dark mb-1">
                                <i class="fas fa-star"></i> {{ "%.1f"|format(restaurant.rating) }}
                            </span>
                            {% endif %}

                            {% if restaurant.service_level %}
                                {% from 'macros/badge_helpers.html' import service_level_badge %}
                                {{ service_level_badge(restaurant.service_level, size='sm') }}
                            {% endif %}

                        </div>
                    </div>

                    <p class="card-text text-muted small mb-2">
                        <i class="fas fa-map-marker-alt me-2"></i>
                        {% if restaurant.address or restaurant.city or restaurant.state or restaurant.postal_code %}
                            {% if restaurant.address %}<div>{{ restaurant.address }}</div>{% endif %}
                            {% if restaurant.city or restaurant.state or restaurant.postal_code %}
                                <div>{{ [restaurant.city, restaurant.state, restaurant.postal_code]|select|join(", ") }}</div>
                            {% endif %}
                        {% else %}
                            <span class="text-muted">No location</span>
                        {% endif %}
                    </p>
                    {% if restaurant.phone %}
                    <p class="card-text text-muted small mb-2">
                        <i class="fas fa-phone me-2"></i> {{ restaurant.phone }}
                    </p>
                    {% endif %}
                    {% if restaurant.website %}
                    <p class="card-text text-muted small mb-2">
                        <i class="fas fa-globe me-2"></i>
                        <a href="{{ restaurant.website }}" target="_blank" rel="noopener noreferrer" class="text-muted"
                            >{{ restaurant.website[:30] }}{% if restaurant.website|length > 30 %}...{% endif %}</a
                        >
                    </p>
                    {% endif %}

                    <!-- Notes preview -->
                    {% if restaurant.notes %}
                    <div class="card-text small mb-3">
                        <div class="text-muted">
                            <i class="fas fa-sticky-note me-2"></i>
                            <span class="fst-italic">{{ restaurant.notes }}</span>
                        </div>
                    </div>
                    {% endif %}

                    <div class="d-flex justify-content-between align-items-center pt-2 border-top">
                        <div class="d-flex gap-3">
                            <span class="text-muted small">
                                <i class="fas fa-receipt me-2"></i>
                                {{ restaurant.visit_count }} visit{{ 's' if restaurant.visit_count != 1 else '' }}
                            </span>
                            <span class="text-muted small">
                                <i class="fas fa-dollar-sign me-2"></i>
                                ${{ "%.2f"|format(restaurant.total_spent) }}
                            </span>
                        </div>
                        <div class="d-flex gap-2">
                            {% if restaurant.place_id %}
                            <a
                                href="https://www.google.com/maps/search/?api=1&query={{ restaurant.name|urlencode }}&query_place_id={{ restaurant.place_id }}"
                                target="_blank"
                                rel="noopener noreferrer"
                                class="btn btn-sm btn-outline-secondary"
                                data-bs-toggle="tooltip"
                                title="View on Google Maps">
                                <i class="fas fa-map-marked-alt me-1"></i><span class="d-none d-sm-inline">Maps</span>
                            </a>
                            {% endif %}

                            <a
                                href="{{ url_for('expenses.add_expense', restaurant_id=restaurant.id) }}"
                                class="btn btn-sm btn-outline-primary"
                                data-bs-toggle="tooltip"
                                title="Add new expense">
                                <i class="fas fa-plus me-1"></i><span class="d-none d-lg-inline">Add Expense</span>
                            </a>
                                    <button
                                        type="button"
                                        class="btn btn-sm btn-outline-danger"
                                        data-bs-toggle="modal"
                                        data-bs-target="#deleteRestaurantModal"
                                        data-restaurant-id="{{ restaurant.id }}"
                                        data-restaurant-name="{{ restaurant.name }}"
                                        data-tooltip="true"
                                        title="Delete restaurant">
                                        <i class="fas fa-trash"></i>
                                    </button>
                        </div>
                    </div>

                    {% if restaurant.last_visit %}
                    <div class="mt-2 text-muted small">
                        <i class="far fa-calendar-alt me-2"></i>
                        Last visited {{ restaurant.last_visit|time_ago }}
                    </div>
                    {% endif %}

                </div>
            </div>
        </div>
        {% endfor %}
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteRestaurantModal" tabindex="-1" aria-labelledby="deleteRestaurantModalLabel">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteRestaurantModalLabel">
                    <i class="fas fa-exclamation-triangle me-2"></i>Confirm Deletion
                </h5>
                <button
                    type="button"
                    class="btn-close btn-close-white"
                    data-bs-dismiss="modal"
                    aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p> Are you sure you want to delete <strong id="restaurantName"></strong>? </p>
                <p class="text-danger">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    This action cannot be undone. All associated expenses will also be deleted.
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i> Cancel
                </button>
                <form id="deleteRestaurantForm" method="post" action="" data-delete-url="{{ url_for('restaurants.delete_restaurant', restaurant_id=0).replace('/0', '') }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash me-2"></i> Delete Restaurant
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Table View (full width - break out with negative margins) -->
<div id="table-view-container" class="d-none">
    <div class="restaurant-table-fullwidth">
        <div class="card">
            <div class="card-body p-0">
                <div class="table-sticky-frozen">
                    <table id="restaurantTable" class="table table-hover align-middle restaurant-table mb-0">
                        <thead class="table-light">
                            <tr>
                                <th data-sort="true" data-sort-type="text">Name</th>
                                <th data-sort="true" data-sort-type="text">Location</th>
                                <th data-sort="true" data-sort-type="text">Service Level</th>
                                <th data-sort="true" data-sort-type="number">Rating</th>
                                <th data-sort="true" data-sort-type="number">Visits</th>
                                <th data-sort="true" data-sort-type="date">Last Visit</th>
                                <th data-sort="true" data-sort-type="currency" class="text-end">Avg $ / Person</th>
                                <th data-sort="true" data-sort-type="currency" class="text-end">Total Spent</th>
                                <th class="text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for restaurant in restaurants %}
                            <tr>
                                <td>
                                    <div class="d-flex align-items-start">
                                        <!-- Restaurant Icon (small for table view) -->
                                        <div class="restaurant-icon-table me-2 flex-shrink-0 d-flex align-items-center">
                                            {% if restaurant.website %}
                                                <img
                                                    src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"
                                                    data-website="{{ restaurant.website }}"
                                                    data-size="20"
                                                    alt="{{ restaurant.name }} icon"
                                                    class="restaurant-favicon-table"
                                                    width="20"
                                                    height="20"
                                                    style="opacity: 0; transition: opacity 0.2s ease-in-out;" />
                                            <i class="fas fa-utensils text-primary restaurant-fallback-icon-table" style="font-size: 16px; display: none;"></i>
                                            {% else %}
                                                <i class="fas fa-utensils text-primary restaurant-fallback-icon-table" style="font-size: 16px;"></i>
                                            {% endif %}
                                        </div>

                                        <!-- Restaurant Name and Cuisine -->
                                        <div>
                                            <a href="{{ url_for('restaurants.restaurant_details', restaurant_id=restaurant.id) }}"
                                                >{{ restaurant.name }}</a
                                            >

                                            <div class="mt-1">
                                                {% from 'macros/badge_helpers.html' import cuisine_badge %}
                                                {{ cuisine_badge(restaurant.cuisine, size='sm') }}
                                            </div>

                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div>
                                                {% if restaurant.city or restaurant.state or restaurant.postal_code %}
                                                    {{ [restaurant.city, restaurant.state, restaurant.postal_code]|select|join(", ") }}
                                                {% else %}
                                                    <span class="text-muted">No location</span>
                                                {% endif %}
                                        </div>
                                        {% if restaurant.place_id %}
                                        <a
                                            href="https://www.google.com/maps/search/?api=1&query={{ restaurant.name|urlencode }}&query_place_id={{ restaurant.place_id }}"
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            class="btn btn-sm btn-outline-secondary ms-2"
                                            data-bs-toggle="tooltip"
                                            title="View on Google Maps">
                                            <i class="fas fa-map-marked-alt me-1"></i><span class="d-none d-lg-inline">Maps</span>
                                        </a>
                                        {% endif %}

                                    </div>
                                </td>
                                <td>
                                    {% if restaurant.service_level %}
                                    {% from 'macros/badge_helpers.html' import service_level_badge %}
                                    {{ service_level_badge(restaurant.service_level, size='sm') }}
                                    {% else %}
                                    <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if restaurant.rating %}
                                    <span
                                        class="badge {% if restaurant.rating >= 4.5 %}bg-success{% elif restaurant.rating >= 3.5 %}bg-warning{% else %}bg-danger{% endif %}">
                                        {{ "%.1f"|format(restaurant.rating) }}
                                    </span>
                                    {% else %}
                                    <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td data-sort-value="{{ restaurant.visit_count }}">
                                    {% if restaurant.visit_count > 0 %}
                                        {{ restaurant.visit_count }}
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td data-sort-value="{% if restaurant.last_visit %}{{ restaurant.last_visit.isoformat() }}{% else %}1970-01-01T00:00:00{% endif %}">
                                    {% if restaurant.last_visit %}
                                    <span
                                        data-bs-toggle="tooltip"
                                        title="{{ restaurant.last_visit|format_datetime_user_tz('%B %d, %Y at %I:%M %p') }}">
                                        {{ restaurant.last_visit|time_ago }}
                                    </span>
                                    {% else %}
                                    <span class="text-muted">No visits</span>
                                    {% endif %}
                                </td>
                                <td class="fw-bold text-info amount-right">
                                    {% if restaurant.visit_count > 0 and restaurant.total_spent > 0 %}
                                        ${{ "%.2f"|format(restaurant.total_spent / restaurant.visit_count) }}
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td class="fw-bold text-success amount-right"
                                    >${{ "%.2f"|format(restaurant.total_spent) }}</td
                                >
                                <td class="actions text-center">
                                    <a
                                        href="{{ url_for('restaurants.restaurant_details', restaurant_id=restaurant.id) }}"
                                        class="btn btn-sm btn-outline-primary"
                                        data-bs-toggle="tooltip"
                                        title="View Details">
                                        <i class="fas fa-eye me-1"></i><span class="d-none d-lg-inline">View</span>
                                    </a>
                                    <a
                                        href="{{ url_for('restaurants.edit_restaurant', restaurant_id=restaurant.id) }}"
                                        class="btn btn-sm btn-outline-secondary"
                                        data-bs-toggle="tooltip"
                                        title="Edit">
                                        <i class="fas fa-edit me-1"></i><span class="d-none d-lg-inline">Edit</span>
                                    </a>
                                    <button
                                        type="button"
                                        class="btn btn-sm btn-outline-danger"
                                        data-bs-toggle="modal"
                                        data-bs-target="#deleteRestaurantModal"
                                        data-restaurant-id="{{ restaurant.id }}"
                                        data-restaurant-name="{{ restaurant.name }}"
                                        data-tooltip="true"
                                        title="Delete">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot class="table-secondary">
                            <tr>
                                <td colspan="6" class="text-end fw-bold">Total:</td>
                                <td class="fw-bold text-info amount-right">
                                    {% if avg_price_per_person %}
                                        ${{ "%.2f"|format(avg_price_per_person) }}
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td class="fw-bold text-success amount-right">${{ "%.2f"|format(total_spent) if total_spent else '0.00' }}</td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock content %}

{% block extra_js %}
<!-- Table sorting functionality -->
<script src="{{ url_for('static', filename='js/components/table-sorting.js') }}"></script>
<script type="module" src="{{ url_for('static', filename='js/pages/restaurant-list.js') }}"></script>
{% endblock extra_js %}
