{% from 'macros/cuisine_helpers.html' import cuisine_badge %}
<tr>
    <td>
        <div class="d-flex align-items-start">
            <!-- Restaurant Icon (small for table view) -->
            <div class="restaurant-icon-table me-2 flex-shrink-0 d-flex align-items-start" style="align-self: flex-start;">
                {% if restaurant.website %}
                <img
                    src="https://t3.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url={{ restaurant.website }}&size=28"
                    alt="{{ restaurant.name }} icon"
                    class="restaurant-favicon-table"
                    width="28"
                    height="28"
                    loading="lazy"
                    onerror="this.style.display='none'; this.nextElementSibling.style.display='inline-block'; this.nextElementSibling.style.marginTop='2px';"
                    onload="this.style.opacity='1';"
                    style="opacity: 0; transition: opacity 0.2s; margin-top: 2px;" />
                <i
                    class="fas fa-utensils text-primary restaurant-fallback-icon-table"
                    style="display: none; font-size: 24px; margin-top: 2px;"></i>
                {% else %}
                <i class="fas fa-utensils text-primary restaurant-fallback-icon-table" style="font-size: 24px; margin-top: 2px;"></i>
                {% endif %}
            </div>

            <!-- Restaurant Name and Cuisine -->
            <div>
                <a href="{{ url_for('restaurants.restaurant_details', restaurant_id=restaurant.id) }}"
                    >{{ restaurant.name }}</a
                >
                {% if restaurant.cuisine %}
                <div class="mt-1">
                    {{ cuisine_badge(restaurant.cuisine, compact=true) }}
                </div>
                {% endif %}
            </div>
        </div>
    </td>
    <td>
        <div class="d-flex align-items-center">
            <div>
                {% if restaurant.city or restaurant.state %} {% set location_parts = [] %} {% if restaurant.city %}{%
                set _ = location_parts.append(restaurant.city) %}{% endif %} {% if restaurant.state %}{% set _ =
                location_parts.append(restaurant.state) %}{% endif %} {{ location_parts|join(', ') }} {% else %}
                <span class="text-muted">-</span>
                {% endif %}
            </div>
            {% set maps_url = restaurant|google_maps_url %} {% if maps_url %}
            <a
                href="{{ maps_url }}"
                target="_blank"
                rel="noopener noreferrer"
                class="btn btn-sm btn-outline-secondary ms-2"
                data-bs-toggle="tooltip"
                title="View on Google Maps">
                <i class="fas fa-map-marked-alt"></i>
            </a>
            {% endif %}
        </div>
    </td>
    <td>
        {% if restaurant.service_level %}
        <span class="service-level-badge-sm" data-service-level="{{ restaurant.service_level }}">
            <i class="fas fa-concierge-bell"></i> {{ restaurant.service_level|replace('_', ' ')|title }}
        </span>
        {% else %}
        <span class="text-muted">-</span>
        {% endif %}
    </td>
    <td>
        {% if restaurant.rating %}
        <span
            class="badge bg-{{ 'success' if restaurant.rating >= 4 else 'warning' if restaurant.rating >= 3 else 'danger' }}">
            {{ "%.1f"|format(restaurant.rating) }}
        </span>
        {% else %}
        <span class="text-muted">No rating</span>
        {% endif %}
    </td>
    <td>{{ restaurant.visit_count }}</td>
    <td>
        {% if last_visit %}
        <span
            data-sort-value="{{ last_visit.isoformat() }}"
            data-bs-toggle="tooltip"
            title="{{ last_visit.strftime('%B %d, %Y at %I:%M %p') }}">
            {{ last_visit|time_ago }}
        </span>
        {% else %}
        <span class="text-muted" data-sort-value="">No visits</span>
        {% endif %}
    </td>
    <td class="fw-bold text-info amount-right">
        {% if restaurant.avg_price_per_person and restaurant.avg_price_per_person > 0 %}
            ${{ "%.2f"|format(restaurant.avg_price_per_person) }}
        {% else %}
            <span class="text-muted">-</span>
        {% endif %}
    </td>
    <td class="fw-bold text-success amount-right"
        >${{ "%.2f"|format(restaurant.total_spent) if restaurant.total_spent is defined else '0.00' }}</td
    >
    <td class="actions text-center">
        <a
            href="{{ url_for('restaurants.restaurant_details', restaurant_id=restaurant.id) }}"
            class="btn btn-sm btn-outline-primary"
            data-bs-toggle="tooltip"
            title="View Details">
            <i class="fas fa-eye"></i>
        </a>
        <a
            href="{{ url_for('restaurants.edit_restaurant', restaurant_id=restaurant.id) }}"
            class="btn btn-sm btn-outline-secondary"
            data-bs-toggle="tooltip"
            title="Edit">
            <i class="fas fa-edit"></i>
        </a>
        <button
            type="button"
            class="btn btn-sm btn-outline-danger"
            data-bs-toggle="modal"
            data-bs-target="#deleteRestaurantModal"
            data-restaurant-id="{{ restaurant.id }}"
            data-restaurant-name="{{ restaurant.name }}"
            data-bs-toggle="tooltip"
            title="Delete">
            <i class="fas fa-trash"></i>
        </button>
    </td>
</tr>
