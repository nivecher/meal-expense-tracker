{% from 'macros/badge_helpers.html' import cuisine_badge %}
<tr>
    <td>
        <div class="d-flex align-items-start">
            <!-- Restaurant Icon (small for table view) -->
            <div class="restaurant-icon-table me-2 flex-shrink-0 d-flex align-items-center">
                {% if restaurant.website %}
                <img
                    src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"
                    data-website="{{ restaurant.website }}"
                    data-size="20"
                    alt="{{ restaurant.name }} icon"
                    class="restaurant-favicon-table"
                    width="20"
                    height="20"
                    style="opacity: 0; transition: opacity 0.2s ease-in-out" />
                {% endif %}
                <i
                    class="fas fa-utensils text-primary restaurant-fallback-icon-table{% if restaurant.website %} d-none{% endif %}"
                    style="font-size: 16px"></i>
            </div>

            <!-- Restaurant Name and Cuisine -->
            <div>
                <div class="d-flex align-items-center gap-2">
                    <a href="{{ url_for('restaurants.restaurant_details', restaurant_id=restaurant.id) }}"
                        >{{ restaurant.name }}</a
                    >
                    {% if restaurant.price_level is not none %}
                    <span class="text-muted">â€¢</span>
                    {% from 'macros/badge_helpers.html' import price_level_badge %} {{
                    price_level_badge(restaurant.price_level, size='sm') }} {% endif %}
                </div>
                {% if restaurant.cuisine %}
                <div class="mt-1">
                    {% from 'macros/badge_helpers.html' import cuisine_badge %} {{ cuisine_badge(restaurant.cuisine,
                    size='sm') }}
                </div>
                {% endif %}
            </div>
        </div>
    </td>
    <td>
        <div class="d-flex align-items-start">
            <i class="fas fa-map-marker-alt me-2 mt-1 flex-shrink-0 text-muted"></i>
            <div class="flex-grow-1">
                {% if restaurant.get('address') or restaurant.get('city') or restaurant.get('state') or
                restaurant.get('postal_code') %}
                <div>{{ restaurant|restaurant_address_only|replace('\n', '<br />')|safe }}</div>
                {% else %}
                <span class="text-muted">No address</span>
                {% endif %}
            </div>
            {% set maps_url = restaurant|google_maps_url %} {% if maps_url %}
            <a
                href="{{ maps_url }}"
                target="_blank"
                rel="noopener noreferrer"
                class="btn btn-sm btn-outline-secondary ms-2"
                data-bs-toggle="tooltip"
                title="View on Google Maps">
                <i class="fas fa-map-marked-alt"></i>
            </a>
            {% endif %}
        </div>
    </td>
    <td>
        {% if restaurant.service_level %} {% from 'macros/badge_helpers.html' import service_level_badge %} {{
        service_level_badge(restaurant.service_level, size='sm') }} {% else %}
        <span class="text-muted">-</span>
        {% endif %}
    </td>
    <td>
        {% if restaurant.rating %}
        <span
            class="badge bg-{{ 'success' if restaurant.rating >= 4 else 'warning' if restaurant.rating >= 3 else 'danger' }}">
            {{ "%.1f"|format(restaurant.rating) }}
        </span>
        {% else %}
        <span class="text-muted">No rating</span>
        {% endif %}
    </td>
    <td data-sort-value="{{ restaurant.visit_count }}">
        {% if restaurant.visit_count > 0 %} {{ restaurant.visit_count }} {% else %}
        <span class="text-muted">-</span>
        {% endif %}
    </td>
    <td data-sort-value="{% if last_visit %}{{ last_visit.isoformat() }}{% else %}1970-01-01T00:00:00{% endif %}">
        {% if last_visit %}
        <span data-bs-toggle="tooltip" title="{{ last_visit|format_datetime_user_tz('%B %d, %Y at %I:%M %p') }}">
            {{ last_visit|time_ago }}
        </span>
        {% else %}
        <span class="text-muted">No visits</span>
        {% endif %}
    </td>
    <td class="fw-bold text-info amount-right">
        {% if restaurant.avg_price_per_person and restaurant.avg_price_per_person > 0 %} ${{
        "%.2f"|format(restaurant.avg_price_per_person) }} {% else %}
        <span class="text-muted">-</span>
        {% endif %}
    </td>
    <td class="fw-bold text-success amount-right"
        >${{ "%.2f"|format(restaurant.total_spent) if restaurant.total_spent is defined else '0.00' }}</td
    >
    <td class="actions text-center">
        <a
            href="{{ url_for('restaurants.restaurant_details', restaurant_id=restaurant.id) }}"
            class="btn btn-sm btn-outline-primary"
            data-bs-toggle="tooltip"
            title="View Details">
            <i class="fas fa-eye"></i>
        </a>
        <a
            href="{{ url_for('restaurants.edit_restaurant', restaurant_id=restaurant.id) }}"
            class="btn btn-sm btn-outline-secondary"
            data-bs-toggle="tooltip"
            title="Edit">
            <i class="fas fa-edit"></i>
        </a>
        <button
            type="button"
            class="btn btn-sm btn-outline-danger"
            data-bs-toggle="modal"
            data-bs-target="#deleteRestaurantModal"
            data-restaurant-id="{{ restaurant.id }}"
            data-restaurant-name="{{ restaurant.name }}"
            data-tooltip="true"
            title="Delete">
            <i class="fas fa-trash"></i>
        </button>
    </td>
</tr>
