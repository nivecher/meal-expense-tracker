{% from 'macros/badge_helpers.html' import cuisine_badge %}
<tr>
    <td>
        <div class="d-flex align-items-start">
            <!-- Restaurant Icon (small for table view) -->
            <div class="restaurant-icon-table me-2 flex-shrink-0 d-flex align-items-center">
                {% if restaurant.website %}
                    <img
                        src="https://www.google.com/s2/favicons?domain={{ restaurant.website.replace('http://', '').replace('https://', '').replace('www.', '').split('/')[0] }}&sz=20"
                        data-website="{{ restaurant.website }}"
                        alt="{{ restaurant.name }} icon"
                        class="restaurant-favicon-table"
                        width="20"
                        height="20"
                        onerror="handleFaviconError(this);"
                        onload="this.style.opacity='1';"
                        style="opacity: 0; transition: opacity 0.2s ease-in-out;"
                    />
                {% endif %}
                <i class="fas fa-utensils text-primary restaurant-fallback-icon-table{% if restaurant.website %} d-none{% endif %}" style="font-size: 16px;"></i>
            </div>

            <!-- Restaurant Name and Cuisine -->
            <div>
                <a href="{{ url_for('restaurants.restaurant_details', restaurant_id=restaurant.id) }}"
                    >{{ restaurant.name }}</a
                >
                {% if restaurant.cuisine %}
                <div class="mt-1">
                    {% from 'macros/badge_helpers.html' import cuisine_badge %}
                    {{ cuisine_badge(restaurant.cuisine, size='sm') }}
                </div>
                {% endif %}
            </div>
        </div>
    </td>
    <td>
        <div class="d-flex align-items-start">
            <i class="fas fa-map-marker-alt me-2 mt-1 flex-shrink-0 text-muted"></i>
            <div class="flex-grow-1">
                {% if restaurant.address or restaurant.city or restaurant.state or restaurant.postal_code %}
                    {% if restaurant.address %}<div class="small text-muted">{{ restaurant.address }}</div>{% endif %}
                    {% if restaurant.city or restaurant.state or restaurant.postal_code %}
                        <div>{{ [restaurant.city, restaurant.state, restaurant.postal_code]|select|join(", ") }}</div>
                    {% endif %}
                {% else %}
                    <span class="text-muted">-</span>
                {% endif %}
            </div>
            {% set maps_url = restaurant|google_maps_url %} {% if maps_url %}
            <a
                href="{{ maps_url }}"
                target="_blank"
                rel="noopener noreferrer"
                class="btn btn-sm btn-outline-secondary ms-2"
                data-bs-toggle="tooltip"
                title="View on Google Maps">
                <i class="fas fa-map-marked-alt"></i>
            </a>
            {% endif %}
        </div>
    </td>
    <td>
        {% if restaurant.service_level %}
        {% from 'macros/badge_helpers.html' import service_level_badge %}
        {{ service_level_badge(restaurant.service_level, size='sm') }}
        {% else %}
        <span class="text-muted">-</span>
        {% endif %}
    </td>
    <td>
        {% if restaurant.rating %}
        <span
            class="badge bg-{{ 'success' if restaurant.rating >= 4 else 'warning' if restaurant.rating >= 3 else 'danger' }}">
            {{ "%.1f"|format(restaurant.rating) }}
        </span>
        {% else %}
        <span class="text-muted">No rating</span>
        {% endif %}
    </td>
    <td>{{ restaurant.visit_count }}</td>
    <td>
        {% if last_visit %}
        <span
            data-sort-value="{{ last_visit.isoformat() }}"
            data-bs-toggle="tooltip"
            title="{{ last_visit|format_datetime_user_tz('%B %d, %Y at %I:%M %p') }}">
            {{ last_visit|time_ago }}
        </span>
        {% else %}
        <span class="text-muted" data-sort-value="">No visits</span>
        {% endif %}
    </td>
    <td class="fw-bold text-info amount-right">
        {% if restaurant.avg_price_per_person and restaurant.avg_price_per_person > 0 %}
            ${{ "%.2f"|format(restaurant.avg_price_per_person) }}
        {% else %}
            <span class="text-muted">-</span>
        {% endif %}
    </td>
    <td class="fw-bold text-success amount-right"
        >${{ "%.2f"|format(restaurant.total_spent) if restaurant.total_spent is defined else '0.00' }}</td
    >
    <td class="actions text-center">
        <a
            href="{{ url_for('restaurants.restaurant_details', restaurant_id=restaurant.id) }}"
            class="btn btn-sm btn-outline-primary"
            data-bs-toggle="tooltip"
            title="View Details">
            <i class="fas fa-eye me-1"></i><span class="d-none d-lg-inline">View</span>
        </a>
        <a
            href="{{ url_for('restaurants.edit_restaurant', restaurant_id=restaurant.id) }}"
            class="btn btn-sm btn-outline-secondary"
            data-bs-toggle="tooltip"
            title="Edit">
            <i class="fas fa-edit me-1"></i><span class="d-none d-lg-inline">Edit</span>
        </a>
        <button
            type="button"
            class="btn btn-sm btn-outline-danger"
            data-bs-toggle="modal"
            data-bs-target="#deleteRestaurantModal"
            data-restaurant-id="{{ restaurant.id }}"
            data-restaurant-name="{{ restaurant.name }}"
            data-tooltip="true"
            title="Delete">
            <i class="fas fa-trash me-1"></i><span class="d-none d-lg-inline">Delete</span>
        </button>
    </td>
</tr>
