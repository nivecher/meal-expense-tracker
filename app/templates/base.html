<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!-- Theme color removed - causing compatibility warnings -->
        <meta name="description" content="Track and manage your meal expenses with our easy-to-use expense tracker" />
        <meta name="keywords" content="meal expense tracker, food expenses, budget tracking, expense management" />
        <meta name="author" content="Meal Expense Tracker" />
        <meta name="csrf-token" content="{{ csrf_token() }}" />

        <!-- Unified Error Handler - MUST LOAD FIRST -->
        <script src="{{ url_for('static', filename='js/utils/unified-error-handler.js') }}"></script>

        <!-- Bootstrap Icons -->
        <title> {% block title %} Meal Expense Tracker {% endblock title %} </title>
        <!-- Favicon -->
        <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='img/favicons/favicon.ico') }}" />
        <link
            rel="icon"
            type="image/png"
            sizes="32x32"
            href="{{ url_for('static', filename='img/favicons/favicon-32x32.png') }}"
            width="32"
            height="32" />
        <link
            rel="icon"
            type="image/png"
            sizes="16x16"
            href="{{ url_for('static', filename='img/favicons/favicon-16x16.png') }}"
            width="16"
            height="16" />
        <link
            rel="apple-touch-icon"
            sizes="180x180"
            href="{{ url_for('static', filename='img/favicons/apple-touch-icon.png') }}"
            width="180"
            height="180" />
        <link rel="manifest" href="{{ url_for('static', filename='img/favicons/site.webmanifest') }}" />
        <!-- Centralized Dependencies -->
        {% include 'includes/dependencies.html' %}
        <link href="{{ url_for('static', filename='css/main.css') }}" rel="stylesheet" />
        <!-- Google Places CSS removed - not needed for direct API calls -->
        {% block styles %}{% endblock styles %} {% if config.DEBUG %}
        <script type="module" src="{{ url_for('static', filename='js/utils/debug.js') }}"></script>
        {% endif %}
        <!-- Moved to static/css/main.css -->
        {% block head_extra %} {% endblock head_extra %}
    </head>
    <body>
        <div class="app-shell">
            {% include "includes/sidebar.html" %}
            <div class="sidebar-backdrop" data-sidebar-backdrop aria-hidden="true"></div>
            <button
                type="button"
                class="btn btn-sm btn-outline-secondary sidebar-mobile-toggle fixed-top-left"
                data-sidebar-mobile-toggle
                aria-label="Open menu"
                aria-controls="appSidebar">
                <i class="fas fa-bars" aria-hidden="true" data-sidebar-mobile-icon></i>
            </button>
            <div class="app-content">
                {% if self.section_header() %}
                <div class="section-header">
                    <div class="section-header-inner"> {% block section_header %}{% endblock %} </div>
                </div>
                {% endif %}
                <main id="main-content" class="{% block main_container_class %}container{% endblock %} py-4">
                    <!-- Flash Messages -->
                    {% with messages = get_flashed_messages(with_categories=true) %} {% if messages %}
                    <div class="flash-messages mb-4">
                        {% for category, message in messages %}
                        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                            <div class="alert-message">{{ message }}</div>
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %} {% endwith %}
                    <!-- Toast Container -->
                    <div id="toast-container" class="toast-container position-fixed bottom-0 end-0 p-3"> </div>
                    {% block content %} {% endblock content %}
                </main>
                <footer class="footer mt-5 py-4 bg-light">
                    <div class="container">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <p class="mb-0"> 2025 Meal Expense Tracker. All rights reserved. </p>
                            </div>
                            <div class="col-md-6 text-md-end">
                                <a href="{{ url_for('main.about') }}" class="text-muted me-3" title="About Us">About</a>
                                <a href="{{ url_for('main.terms') }}" class="text-muted me-3" title="Terms of Service"
                                    >Terms</a
                                >
                                <a href="{{ url_for('main.privacy') }}" class="text-muted me-3" title="Privacy Policy"
                                    >Privacy</a
                                >
                                <a href="{{ url_for('main.contact') }}" class="text-muted" title="Contact Us"
                                    >Contact</a
                                >
                            </div>
                        </div>
                    </div>
                </footer>
            </div>
        </div>
        <!-- Application Configuration -->
        <div
            id="app-config"
            data-app-config='{
                "staticBaseUrl": "{{ request.script_root or "" }}",
                "app": {
                    "debug": {{ "true" if config.DEBUG else "false" }},
                    "env": "{{ config.get("ENVIRONMENT", "dev") }}",
                    "version": "{{ get_app_version() }}"
                },
                "googleMaps": {
                    "apiKey": "{{ config.GOOGLE_MAPS_API_KEY or "" }}"
                },
                "colors": {
                    "gray": "#6c757d",
                    "orange": "#fd7e14",
                    "green": "#198754",
                    "cyan": "#0dcaf0",
                    "red": "#dc3545",
                    "purple": "#6f42c1",
                    "blue": "#0d6efd"
                },
                "cuisines": {{ cuisine_names|tojson }},
                "mealTypes": {{ meal_types|tojson }}
            }'>
        </div>
        <!-- Unified Error Handler already loaded above -->

        <!-- Single Application Entrypoint -->
        <script type="module" src="{{ url_for('static', filename='js/app.js') }}" defer></script>
        {% if config.DEBUG %}
        <script type="module" src="{{ url_for('static', filename='js/utils/debug.js') }}" defer></script>
        <script type="module" src="{{ url_for('static', filename='js/utils/console-test.js') }}" defer></script>
        <!-- Console warning filter for development -->
        <script src="{{ url_for('static', filename='js/utils/console-filter.js') }}"></script>
        {% endif %}
        <!-- Page-specific scripts -->
        {% block scripts %} {% endblock scripts %} {% block extra_js %} {% endblock extra_js %}
    </body>
</html>
